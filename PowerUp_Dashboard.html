<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>PowerUp Dashboard</title>

  <!-- Fonts / Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <!-- Styles -->
  <link rel="stylesheet" href="/styles/powerup.css" />
</head>

<body class="dashboard">
  <div class="container">

    <!-- ── Sidebar ─────────────────────────────────────────────── -->
    <div class="sidebar" id="sidebar">
      <div class="item" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i><span>Menu</span>
      </div>
      <div class="item active" onclick="location.href='PowerUp_Dashboard.html'">
        <i class="fas fa-home"></i><span>Dashboard</span>
      </div>
      <div class="item" onclick="location.href='level-tracker.html'">
        <i class="fas fa-layer-group"></i><span>Level Tracker</span>
      </div>
      <div class="item" onclick="location.href='power-hours.html'">
        <i class="fas fa-clock"></i><span>Power Hours</span>
      </div>
      <div class="item" onclick="location.href='notes.html'">
        <i class="fas fa-sticky-note"></i><span>Notes</span>
      </div>
      <div class="item" onclick="location.href='squads.html'">
        <i class="fas fa-users"></i><span>Squads</span>
      </div>
    </div>

    <!-- ── Main ────────────────────────────────────────────────── -->
    <div class="main">

      <!-- Header / KPI cards -->
      <div class="header">
        <h1>PowerUp Dashboard</h1>
        <p>
          Welcome: <span>Chris Weikel</span> 
          Month: <span>July 2025</span> 
          Level: <span>Lv 2</span>
        </p>
      </div>

      <div class="top-cards">
        <div class="card power-card">
          <h3>Power Hours Logged</h3>
          <p>1.0 / 8</p>
          <div class="progress-bar"><div class="progress-bar-inner"></div></div>
          <small>You’re 7 hour(s) away from your goal. 30 day(s) left this month.</small>
        </div>

        <div class="card token-card">
          <h3>Tokens</h3>
          <div class="token-tracker"><i class="fas fa-coins"></i><span>20</span></div>
        </div>
      </div>

      <!-- ── Tabs ──────────────────────────────────────────────── -->
      <div class="tab-buttons">
        <button class="tab-button active" onclick="showTab('ci')">Continuous Improvement</button>
        <button class="tab-button" onclick="showTab('safety')">Safety Concerns</button>
        <button class="tab-button" onclick="showTab('quality')">Quality Catches</button>
      </div>

      <!-- ── CI Tab ────────────────────────────────────────────── -->
      <div class="tab-panel active" id="tab-ci">
        <div class="table-header-row">
          <h3>Continuous Improvement (CI)</h3>
          <div class="table-header-controls">
            <select id="ci-filter" onchange="filterTable('ci')">
              <option value="all">All Statuses</option>
              <option value="approved">Approved</option>
              <option value="pending">Pending</option>
              <option value="denied">Denied</option>
            </select>
            <button class="add-btn">+ Add Submission</button>
            <span id="ci-count" class="row-count">0 submissions</span>
          </div>
        </div>

        <div class="table-scroll">
          <table id="ci-table"></table>
        </div>
      </div>

      <!-- ── Safety Tab ────────────────────────────────────────── -->
      <div class="tab-panel" id="tab-safety">
        <div class="table-header-row">
          <h3>Safety Concerns</h3>
          <div class="table-header-controls">
            <select id="safety-filter" onchange="filterTable('safety')">
              <option value="all">All Statuses</option>
              <option value="accepted">Accepted</option>
              <option value="pending">Pending</option>
              <option value="denied">Denied</option>
            </select>
            <button class="add-btn">+ Add Submission</button>
            <span id="safety-count" class="row-count">0 submissions</span>
          </div>
        </div>

        <div class="table-scroll">
          <table id="safety-table"></table>
        </div>
      </div>

      <!-- ── Quality Catches Tab ───────────────────────────────── -->
      <div class="tab-panel" id="tab-quality">
        <div class="table-header-row">
          <h3>Quality Catches</h3>
          <div class="table-header-controls">
            <select id="quality-filter" onchange="filterTable('quality')">
              <option value="all">All</option>
              <option value="pending">Pending</option>
              <option value="closed">Closed</option>
            </select>
            <button class="add-btn">+ Add Submission</button>
            <span id="quality-count" class="row-count">0 submissions</span>
          </div>
        </div>

        <div class="table-scroll">
          <table id="quality-table"></table>
        </div>
      </div>

    </div><!-- /main -->
  </div><!-- /container -->

 <!-- ── Inline helpers ───────────────────────────────────────── -->
<script>
  /* Sidebar toggle — make it global so inline onclick can reach it */
  window.toggleSidebar = function () {
    document.getElementById('sidebar').classList.toggle('expanded');
  };

  /* Tab switching — also global; works even if `event` is undefined */
  window.showTab = function (id) {
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));

    document.getElementById(`tab-${id}`)?.classList.add('active');

    // Make the clicked button active (fallback if `event` isn't available)
    const btn =
      (window.event && window.event.currentTarget) ||
      document.querySelector(`.tab-buttons .tab-button[onclick*="'${id}'"]`);
    if (btn) btn.classList.add('active');

    filterTable(id);
    if (currentSort.tabId === id) sortTable(id, currentSort.colIndex);
  };

  /* Filtering & sorting (keep these global for inline calls) */
  const visibleCount = { ci: Infinity, safety: Infinity, quality: Infinity }; // show every row
  let currentSort = { tabId: null, colIndex: null, asc: true };

  window.filterTable = function (t) {
    const rows = [...document.querySelectorAll(`#${t}-table tbody tr`)];
    const filter = (document.getElementById(`${t}-filter`) || {}).value?.toLowerCase() || 'all';
    let count = 0;
    rows.forEach(r => {
      const show = (filter === 'all' || r.innerText.toLowerCase().includes(filter));
      r.style.display = show ? '' : 'none';
      if (show) count++;
    });
    const counter = document.getElementById(`${t}-count`);
    if (counter) counter.textContent = `${count} submission${count !== 1 ? 's' : ''}`;
  };

  window.sortTable = function (t, i) {
    const tbody = document.querySelector(`#${t}-table tbody`);
    if (!tbody) return;
    const rows = [...tbody.rows].filter(r => r.style.display !== 'none');
    const numeric = rows.every(r => !isNaN(r.cells[i].innerText.replace(/[^0-9.-]/g, '')));
    const asc = (currentSort.tabId === t && currentSort.colIndex === i) ? !currentSort.asc : true;

    rows.sort((a, b) => {
      const A = numeric ? parseFloat(a.cells[i].innerText) : a.cells[i].innerText;
      const B = numeric ? parseFloat(b.cells[i].innerText) : b.cells[i].innerText;
      return asc ? (A > B ? 1 : -1) : (A < B ? 1 : -1);
    }).forEach(r => tbody.appendChild(r));

    currentSort = { tabId: t, colIndex: i, asc };
    filterTable(t);
  };
</script>

  <!-- Module loader -->
  <script type="module" src="/scripts/init-dashboard.js"></script>
</body>
</html>

